# 阅读主题功能说明

## 功能概述

阅读主题功能为用户提供了多种背景和字体颜色主题选择，以提升阅读体验。用户可以根据个人喜好和环境光线选择合适的主题。

## 功能特性

### 1. 字体大小管理
- 支持 12px - 24px 范围内的字体大小调整
- 每次调整步长为 2px
- 默认字体大小为 16px
- 字体大小设置会持久化保存

### 2. 主题选择
提供 5 套不同的阅读主题：

#### 默认主题
- 背景色：纯白色 (#FFFFFF)
- 文字色：深灰色 (#212121)
- 卡片色：浅灰色 (#F5F5F5)
- 分割线：灰色 (#E0E0E0)
- 特点：经典白底黑字，清晰易读

#### 浅色主题
- 背景色：浅灰色 (#FAFAFA)
- 文字色：中灰色 (#424242)
- 卡片色：纯白色 (#FFFFFF)
- 分割线：浅灰色 (#E8E8E8)
- 特点：柔和浅色背景，舒适阅读

#### 深色主题
- 背景色：深黑色 (#121212)
- 文字色：浅灰色 (#E0E0E0)
- 卡片色：深灰色 (#1E1E1E)
- 分割线：中灰色 (#424242)
- 特点：深色背景，减少眼睛疲劳

#### 护眼主题
- 背景色：米色 (#F5F5DC)
- 文字色：深棕色 (#3C3C3C)
- 卡片色：浅米色 (#FFF8E1)
- 分割线：浅棕色 (#E8E6D9)
- 特点：米色背景，模拟纸张质感

#### 夜间主题
- 背景色：深蓝灰色 (#263238)
- 文字色：浅灰白色 (#E5E5E7)
- 卡片色：蓝灰色 (#2E3C43)
- 分割线：深蓝灰色 (#455A64)
- 特点：深蓝灰背景，夜间护眼

## 技术实现

### 1. 数据存储
使用 `get_storage` 库进行持久化存储：

```dart
// 字体大小存储键
static const String _fontSizeStorageKey = 'user_font_size';

// 阅读主题存储键
static const String _readingThemeStorageKey = 'user_reading_theme';
```

### 2. 控制器架构
- `ArticleReadThemeController`：管理字体大小和主题设置
- `ReadThemeWidget`：提供用户界面进行设置
- `ArticleMarkdownWidget`：应用设置到 WebView

### 3. WebView 主题应用
通过 JavaScript 动态更新 WebView 中的样式：

```javascript
// 更新CSS变量
document.documentElement.style.setProperty('--background-color', backgroundColor);
document.documentElement.style.setProperty('--text-color', textColor);

// 更新body样式
document.body.style.backgroundColor = backgroundColor;
document.body.style.color = textColor;

// 更新文本元素
const textElements = document.querySelectorAll('p, h1, h2, h3, h4, h5, h6, li, blockquote, pre, code, span, div');
textElements.forEach(element => {
  element.style.color = textColor;
});
```

## 使用方法

### 1. 打开设置界面
在文章阅读页面，点击更多操作按钮，选择"阅读设置"。

### 2. 选择主题
在主题选择区域，点击想要的主题卡片即可应用。

### 3. 调整字体大小
- 使用滑块进行精确调整
- 使用"增大"和"减小"按钮进行快速调整
- 实时预览效果

### 4. 重置设置
点击"重置为默认设置"按钮，将字体大小和主题都恢复到默认状态。

## 文件结构

```
lib/view/article/
├── controller/
│   └── article_read_theme_controller.dart  # 主题控制器
├── article_page/components/
│   └── read_theme_widget.dart             # 设置界面
└── article_markdown/
    └── article_markdown_widget.dart       # 应用主题到WebView
```

## 测试

提供了完整的单元测试覆盖：

- `test/font_size_storage_test.dart`：字体大小存储测试
- `test/reading_theme_test.dart`：阅读主题功能测试

## 注意事项

1. 主题切换会实时应用到当前阅读的文档
2. 设置会自动保存，下次打开应用时会恢复
3. 主题设置对所有文章都生效
4. 字体大小和主题设置是独立的，可以分别调整

## 扩展性

系统设计支持轻松添加新的主题：

1. 在 `ReadingThemeType` 枚举中添加新类型
2. 在 `ThemeConfig` 中定义新主题的配置
3. 在 `currentThemeConfig` getter 中添加新主题的配置

这样的设计使得添加新主题变得简单且不会影响现有功能。 